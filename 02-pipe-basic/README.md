# ğŸ“˜ ç¬¬ 02 è¯¾ â€” æ„å»ºæç¤ºè¯ â†’ æ¨¡å‹ç®¡é“é“¾

æœ¬è¯¾å°†æ•™æ‚¨å¦‚ä½•ä½¿ç”¨ `.pipe()` å°†**æç¤ºæ¨¡æ¿ (Prompt Template)** å’Œ**æ¨¡å‹ (Model)** ç»„åˆæˆä¸€ä¸ªå¯é‡ç”¨çš„å•ä¸€ç®¡é“ã€‚è¿™æœ‰åŠ©äºæˆ‘ä»¬æ„å»ºæ¸…æ™°ã€æ¨¡å—åŒ–ã€å¯æ‰©å±•çš„ AI æµç¨‹ï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½æ‰‹åŠ¨æ ¼å¼åŒ–å’Œè°ƒç”¨æ¨¡å‹ã€‚

---

# ğŸš€ æœ¬è¯¾å°†åšä»€ä¹ˆ (æµç¨‹æ¦‚è¿°)

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„ç®¡é“ï¼š

1ï¸âƒ£ **åŠ è½½ç¯å¢ƒå˜é‡**
â†’ ä½¿æˆ‘ä»¬çš„ API å¯†é’¥å¯ç”¨ã€‚

2ï¸âƒ£ **åˆå§‹åŒ– Gemini 2.0 Flash æ¨¡å‹**
â†’ è¿™æ˜¯æä¾›æœ€ç»ˆç­”æ¡ˆçš„ LLMã€‚

3ï¸âƒ£ **åˆ›å»ºä¸€ä¸ªæç¤ºæ¨¡æ¿**
â†’ ä¾‹å¦‚ï¼š
`"è¯·åƒå‘ä¸€ä¸ª5å²å°å­©è§£é‡Šä¸€æ ·ï¼Œè§£é‡Šä¸€ä¸‹ {topic}"`

4ï¸âƒ£ **å°†æç¤ºè¯å¯¼å…¥æ¨¡å‹**
â†’ è¿™ä¼šè‡ªåŠ¨å½¢æˆï¼š
`æ ¼å¼åŒ–åçš„æç¤º â†’ æ¨¡å‹ â†’ å“åº”`

5ï¸âƒ£ **ä½¿ç”¨è¾“å…¥ (`{topic: "å†°æ·‡æ·‹"}`) è°ƒç”¨é“¾**
â†’ LangChain åœ¨å†…éƒ¨è‡ªåŠ¨æ ¼å¼åŒ–æç¤ºå¹¶å°†å…¶å‘é€ç»™ LLMã€‚

6ï¸âƒ£ **ä»å“åº”ä¸­æ‰“å°åŸå§‹å’Œæ¸…ç†åçš„å†…å®¹**
â†’ äº†è§£æ¨¡å‹è¿”å›äº†ä»€ä¹ˆã€‚

è¿™ä¸ªå•ä¸€çš„é“¾æ„æˆäº†æ›´é«˜çº§ç®¡é“ï¼ˆå¦‚ RAGã€å·¥å…·å’Œæ™ºèƒ½ä½“ï¼‰çš„åŸºç¡€ã€‚

---

# ğŸ”¥ å®Œæ•´æµç¨‹å›¾

```
è¾“å…¥ (topic: "å†°æ·‡æ·‹")
        â”‚
        â–¼
PromptTemplate --- å¡«å…… {topic} ---> "è¯·åƒå‘ä¸€ä¸ª5å²å°å­©è§£é‡Šä¸€æ ·ï¼Œè§£é‡Šä¸€ä¸‹å†°æ·‡æ·‹"
        â”‚
        â–¼
Gemini 2.0 Flash LLM
        â”‚
        â–¼
æœ€ç»ˆ AI å“åº”
```

ä»è¾“å…¥åˆ°æœ€ç»ˆå“åº”ä¹‹é—´çš„ä¸€åˆ‡éƒ½ç”± `.pipe()` è‡ªåŠ¨å¤„ç†ã€‚

---

# ğŸ§  ä»£ç æŒ‰é€»è¾‘å—è§£é‡Š

---

## ğŸ”¹ **1. è®¾ç½®ï¼šåŠ è½½ç¯å¢ƒ + å¯¼å…¥ LangChain**

```js
import { config } from "dotenv";
import { ChatGoogleGenerativeAI } from "@langchain/google-genai";
import { PromptTemplate } from "@langchain/core/prompts";

config();
```

### âœ” æ­¤å—çš„ä½œç”¨ï¼š

- åŠ è½½ `.env` æ–‡ä»¶
- ä½¿æ‚¨çš„ API å¯†é’¥å¯ç”¨ (`process.env.GEMINI_API_KEY`)
- å¯¼å…¥ LangChain æ¨¡å‹å’Œæç¤ºç±»

æ²¡æœ‰è¿™ä¸ªè®¾ç½®ï¼Œå…¶ä»–ä¸€åˆ‡éƒ½æ— æ³•å·¥ä½œã€‚

---

## ğŸ”¹ **2. åˆ›å»º Gemini æ¨¡å‹**

```js
const model = new ChatGoogleGenerativeAI({
  model: "gemini-2.0-flash",
  apiKey: process.env.GEMINI_API_KEY,
});
```

### âœ” æ­¤å—å­˜åœ¨çš„åŸå› ï¼š

- åˆå§‹åŒ– Google Gemini 2.0 Flash æ¨¡å‹
- æ­¤æ¨¡å‹å¤„ç†æœ€ç»ˆçš„æç¤º
- å®ƒå¿«é€Ÿã€ä¾¿å®œï¼Œéå¸¸é€‚åˆé“¾æµ‹è¯•

è¿™å°±æ˜¯æ‚¨çš„ **AI å¤§è„‘**ã€‚

---

## ğŸ”¹ **3. åˆ›å»ºæç¤ºæ¨¡æ¿ (Prompt Template)**

```js
const prompt = PromptTemplate.fromTemplate(`
    è¯·åƒå‘ä¸€ä¸ª5å²å°å­©è§£é‡Šä¸€æ ·ï¼Œè§£é‡Šä¸€ä¸‹ {topic}ã€‚`);
```

### âœ” æ­¤å—å­˜åœ¨çš„åŸå› ï¼š

- `{topic}` æ˜¯ä¸€ä¸ªåŠ¨æ€å ä½ç¬¦
- æˆ‘ä»¬å¯ä»¥å°†æ­¤æç¤ºé‡ç”¨äº**ä»»ä½•è¾“å…¥ä¸»é¢˜**
- æ— éœ€ä¸ºæ¯æ¬¡è°ƒç”¨æ‰‹åŠ¨ç¼–å†™å­—ç¬¦ä¸²

å®ƒä½¿æ‚¨çš„æç¤º**æ¸…æ™°ã€å¯é‡ç”¨ã€å¯ç»´æŠ¤**ã€‚

---

## ğŸ”¹ **4. åˆ›å»ºç®¡é“é“¾ (æç¤ºè¯ â†’ æ¨¡å‹)**

```js
const chain = prompt.pipe(model);
```

### âœ” æ­¤å—çš„ä½œç”¨ï¼š

`.pipe()` å°†æç¤ºæ¨¡æ¿è¿æ¥åˆ°æ¨¡å‹ï¼š

```
è¾“å…¥ â†’ PromptTemplate.format() â†’ Model.invoke() â†’ å“åº”
```

### âœ” ä¸ºä»€ä¹ˆè¿™å¾ˆå¼ºå¤§ï¼š

- æ‚¨æ— éœ€æ‰‹åŠ¨è°ƒç”¨ `.format()`
- æ— éœ€æ‰‹åŠ¨è°ƒç”¨æ¨¡å‹
- LangChain åœ¨å†…éƒ¨å¤„ç†ä¸€åˆ‡
- æ‚¨çš„é“¾å˜æˆäº†ä¸€ä¸ªå¹²å‡€çš„å•ä¸€å‡½æ•°

è¿™å°±æ˜¯æ„å»ºçœŸå® AI ç®¡é“çš„æ–¹å¼ã€‚

---

## ğŸ”¹ **5. æ‰§è¡Œé“¾**

```js
const res = await chain.invoke({ topic: "å†°æ·‡æ·‹" });
```

### âœ” æ­¤å—å­˜åœ¨çš„åŸå› ï¼š

- æ‚¨åªéœ€å°†**ä¸€ä¸ªå¯¹è±¡**ä¼ é€’ç»™æ•´ä¸ªç®¡é“
- LangChain è‡ªåŠ¨ï¼š
  1. æ›¿æ¢ `{topic}`
  2. åˆ›å»ºæœ€ç»ˆæç¤º
  3. å‘é€ç»™ Gemini
  4. è¿”å›ç»“æ„åŒ–è¾“å‡º

æœ€ç®€å•çš„ç®¡é“æ‰§è¡Œæ–¹å¼ã€‚

---

## ğŸ”¹ **6. æ‰“å°åŸå§‹å’Œæ¸…ç†åçš„è¾“å‡º**

```js
console.log("åŸå§‹å“åº”", res);
console.log("é“¾å†…å®¹å“åº”", res.content);
```

### âœ” æ­¤å—çš„é‡è¦æ€§ï¼š

- `åŸå§‹å“åº”` â†’ æ˜¾ç¤ºå®Œæ•´çš„å…ƒæ•°æ®
- `res.content` â†’ æ¥è‡ª LLM çš„çº¯æ–‡æœ¬

åœ¨åç»­æ„å»ºå·¥å…·ã€æ™ºèƒ½ä½“æˆ– RAG ç³»ç»Ÿæ—¶ï¼Œç†è§£è¿™ä¸¤è€…è‡³å…³é‡è¦ã€‚

---

# ğŸ” å®Œæ•´ä»£ç  (å‚è€ƒ)

```js
import { config } from "dotenv";
import { ChatGoogleGenerativeAI } from "@langchain/google-genai";
import { PromptTemplate } from "@langchain/core/prompts";

config();
const model = new ChatGoogleGenerativeAI({
  model: "gemini-2.0-flash",
  apiKey: process.env.GEMINI_API_KEY,
});

const prompt = PromptTemplate.fromTemplate(`
    è¯·åƒå‘ä¸€ä¸ª5å²å°å­©è§£é‡Šä¸€æ ·ï¼Œè§£é‡Šä¸€ä¸‹ {topic}ã€‚`);

// åˆ›å»ºé“¾ï¼šæç¤ºè¯ -> æ¨¡å‹
const chain = prompt.pipe(model);
// chain = (input) => model.invoke( prompt.format(input) )

async function run() {
  const res = await chain.invoke({ topic: "å†°æ·‡æ·‹" });
  console.log("åŸå§‹å“åº”", res);
  console.log("é“¾å†…å®¹å“åº”", res.content);
}
run().catch(console.error);
```

---

# â–¶ï¸ å¦‚ä½•è¿è¡Œ

```
node 02-pipe-basic.js
```

---

# ğŸŒ å®é™…åº”ç”¨åœºæ™¯

- å¯é‡ç”¨çš„ AI æ•™å­¦æ¨¡æ¿
- å¸¦æœ‰åŠ¨æ€æç¤ºçš„èŠå¤©æœºå™¨äºº
- å®¢æˆ·æ”¯æŒå¸¸è§é—®é¢˜è§£ç­”è§£é‡Šå™¨
- æ•™è‚²åº”ç”¨
- AI å†™ä½œåŠ©æ‰‹
- å¤šæ­¥ LLM å·¥ä½œæµ
- ç»“åˆæç¤ºè¯ â†’ æ¨¡å‹ â†’ è¾“å‡ºè§£æå™¨çš„ç®¡é“

åœ¨é«˜çº§æ™ºèƒ½ä½“ AI ä¸­ï¼Œ`.pipe()` è¢«å¹¿æ³›ä½¿ç”¨ã€‚

---

# â­ ä¸‹ä¸€ç« 

ç»§ç»­å­¦ä¹  **ç¬¬ 03 è¯¾ â€” è¾“å‡ºè§£æå™¨ (Output Parsers)**ã€‚
